pipeline{
    agent {
        label 'node-1'
    }
    /*parameters{
        choice(name: 'Branch_to_build', choices: ['main', 'REL_1.0'], description: 'selecting branch to build')
    }*/
    /*triggers{
        pollSCM('* * * * *')
    }*/
    post{
        always{
            echo 'build completed'
            mail to: 'tarunkumarpendem22@gmail.com',
                 subject: 'Job summary',
                 body: """Build is completed for $env.BUILD_URL"""
        }
        failure{
            echo 'build failed'
            mail to: 'tarunkumarpendem22@gmail.com',
                 subject: 'Job summary',
                 body: """Build is failed for $env.BUILD_NUMBER
                          $env.BUILD_URL
                          $env.BUILD_ID"""
        }
        success{
            echo 'build is success'
            mail to: 'tarunkumarpendem22@gmail.com',
                 subject: 'Job summary',
                 body: """Build is successfully completed for $env.BUILD_NUMBER
                          $env.BUILD_URL"""
        }
    }
    stages{
        stage(clone){
            steps{
                git url: 'https://github.com/tarunkumarpendem/spring-petclinic.git',
                    branch: "docker"
            }
        }
        stage('docker image build'){
            steps{
                // pushing the image to jfrog artifactory
                sh """
                      docker image build -t spc:2.0 .
                      docker tag spc:2.0 jan2k23.jfrog.io/docker-docker/spc:2.0
                      docker push jan2k23.jfrog.io/docker-docker/spc:2.0
                    """  
            }
        }
    }
}